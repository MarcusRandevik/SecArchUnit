\chapter{PMD Rule Definition}

\begin{lstlisting}[label=lst:pmd_rule, numbers=left, showstringspaces=false]
class CentralSendingRule extends AbstractJavaRule {
    private static final String SENDING_POINT =
        "atm.transaction.Transaction";
    private static final Collection<String> SENDERS =
        Arrays.asList(
            "atm.physical.NetworkToBank"
        );

    public CentralSendingRule() {
        super();

        // Types of nodes to visit
        addRuleChainVisit(
            ASTClassOrInterfaceBodyDeclaration.class
        );
    }

    @Override
    public Object visit(
            ASTClassOrInterfaceBodyDeclaration body,
            Object data) {
        ASTClassOrInterfaceDeclaration owningClass =
            body.getFirstParentOfType(
                ASTClassOrInterfaceDeclaration.class
            );
        boolean isSendingPoint = owningClass != null &&
            SENDING_POINT.equals(owningClass.getBinaryName());
        if (isSendingPoint) {
            // Method defined in sending point; skip this method
            return data;
        }

        Util.getMethodCallsFrom(body).stream()
            .filter(call -> SENDERS.contains(call.targetOwner)
                && call.argumentCount > 0)
            .forEach(offendingCall -> addViolation(data, offendingCall.source));

        return data;
    }
}
\end{lstlisting}